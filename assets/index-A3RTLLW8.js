import{a as oe,ai as se,A as p,n as M,ay as ne,ap as A,M as m,a4 as B,aj as re,o as k,c as de,e as t,w as n,b as y,y as j,g as R,K as b,u as r,B as w,t as ie,aB as ce,U as q,aC as ue,aD as pe,aE as me,aF as fe,ae as _e,i as ve,aa as ge,at as he,au as ye,av as be,aw as we,ak as Ae,D as ke,aG as Ce,G as xe,H as Ve,aH as Ie,_ as je}from"./index-vpA-h1lW.js";/* empty css                  *//* empty css                   */import{f as Re}from"./validator-RQhN6wQS.js";const Ye={class:"header"},Ee={class:"left"},De={class:"right"},ze={style:{flex:"auto"}},He=oe({__name:"index",setup(Me){se(()=>{Y()});let _=p([]),u=p(1),f=p(10),P=M(()=>_.value.length);const S=M(()=>{const a=(u.value-1)*f.value,e=a+f.value;return _.value.slice(a,e)}),Y=async()=>{await ne().then(a=>{_.value=a.map(e=>({...e.attributes,objectId:e.id,createdAt:A(e.createdAt).format("YYYY-MM-DD HH:mm:ss"),updatedAt:A(e.updatedAt).format("YYYY-MM-DD HH:mm:ss")}),e=>{m({type:"error",message:"获取全部角色信息失败 "+e})})})},U=a=>{u.value=a},K=a=>{f.value=a};let i=p(),d=p(!1),s=B({objectId:"",name:"",description:"",permissionArr:[]});const T=B({name:[{required:!1,trigger:"blur",validator:Re}]}),N=()=>{d.value=!0,Object.assign(s,{objectId:"",name:"",description:"",permissionArr:[]}),ce().then(a=>{v.value=a,s.permissionArr=a}),q(()=>{var a,e;(a=i==null?void 0:i.value)==null||a.clearValidate("name"),(e=i==null?void 0:i.value)==null||e.clearValidate("description")})},E=(a,e)=>(a.forEach(l=>{l.select&&l.level==3&&e.push(l.id),l.children&&l.children.length>0&&E(l.children,e)}),e),O=a=>{d.value=!0,s.permissionArr.length=0,Object.assign(s,a),console.log("roleForm",s),ue(s.objectId).then(e=>{console.log("per",e),v.value=e,s.permissionArr=e,z.value=E(s.permissionArr,[])}),q(()=>{var e,l;(e=i==null?void 0:i.value)==null||e.clearValidate("name"),(l=i==null?void 0:i.value)==null||l.clearValidate("description")})},D=(a,e)=>(console.log(a),a.forEach(l=>{e.includes(l.id)?l.select=!0:l.select=!1,l.children&&l.children.length>0&&D(l.children,e)}),v.value.data=a,v.value),Q=async a=>{if(!a)return;let e=C.value.getCheckedKeys(),l=C.value.getHalfCheckedKeys(),x=e.concat(l);s.permissionArr=D(v.value,x),await a.validate(async h=>{h?s.objectId?pe(s).then(()=>{d.value=!1,m({type:"success",message:"更新成功"}),window.location.reload()},c=>{d.value=!1,m({type:"error",message:"更新失败 "+c})}):me(s).then(()=>{d.value=!1,m({type:"success",message:"添加成功"}),window.location.reload()},c=>{d.value=!1,m({type:"error",message:"添加失败 "+c})}):m({type:"error",message:"表单校验失败"})})},G=async a=>{await fe(a).then(()=>{d.value=!1,m({type:"success",message:"删除成功"}),Y(),u.value=_.value.length>1?u.value:u.value-1},e=>{d.value=!1,m({type:"error",message:"删除失败 "+e})})};let z=p([]),v=p(),C=p();const $={children:"children",label:"title"};let g=p("");const H=async a=>{await Ie("name",a).then(e=>{_.value=e.map(l=>({...l.attributes,objectId:l.id,createdAt:A(l.createdAt).format("YYYY-MM-DD HH:mm:ss"),updatedAt:A(l.updatedAt).format("YYYY-MM-DD HH:mm:ss")}))})},J=async a=>{H(a)},L=()=>{H("")};return(a,e)=>{const l=_e,x=ve,h=ge,c=he,W=ye,X=be,Z=we,F=Ae,V=ke,ee=Ce,ae=xe,le=Ve,I=re("has");return k(),de("div",null,[t(F,null,{default:n(()=>[y("div",Ye,[y("div",Ee,[j((k(),R(l,{type:"primary",onClick:N},{default:n(()=>[b(" 添加角色 ")]),_:1})),[[I,"btn.role.add"]])]),y("div",De,[t(h,{modelValue:r(g),"onUpdate:modelValue":e[1]||(e[1]=o=>w(g)?g.value=o:g=o),placeholder:"请输入角色名称搜索",clearable:"",onClear:L},{suffix:n(()=>[t(x,{name:"iconfont-search",style:{cursor:"pointer",fontSize:"20px"},onClick:e[0]||(e[0]=o=>J(r(g)))})]),_:1},8,["modelValue"])])]),t(X,{border:"",style:{margin:"10px 0px"},data:S.value},{default:n(()=>[t(c,{type:"selection",align:"center",fixed:"left"}),t(c,{label:"#",align:"center",type:"index"}),t(c,{label:"ID",align:"center","show-overflow-tooltip":"",prop:"objectId"}),t(c,{label:"角色名称",align:"center",prop:"name","show-overflow-tooltip":""}),t(c,{label:"角色描述",align:"center",prop:"description","show-overflow-tooltip":""}),t(c,{label:"创建时间",align:"center","show-overflow-tooltip":"",prop:"createdAt"}),t(c,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updatedAt"}),t(c,{label:"操作",width:"250px",align:"center",fixed:"right"},{default:n(({row:o})=>[j((k(),R(l,{type:"primary",size:"small",onClick:te=>O(o)},{default:n(()=>[b(" 编辑 ")]),_:2},1032,["onClick"])),[[I,"btn.role.edit"]]),t(W,{title:`确认删除${o.name}?`,width:"200px",onConfirm:te=>G(o.objectId)},{reference:n(()=>[j((k(),R(l,{type:"primary",size:"small"},{default:n(()=>[b(" 删除 ")]),_:1})),[[I,"btn.role.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),t(Z,{"current-page":r(u),"onUpdate:currentPage":e[2]||(e[2]=o=>w(u)?u.value=o:u=o),"page-size":r(f),"onUpdate:pageSize":e[3]||(e[3]=o=>w(f)?f.value=o:f=o),"page-sizes":[10,20,50],layout:"prev, pager, next, jumper,->,sizes,total",total:r(P),background:"",onCurrentChange:U,onSizeChange:K},null,8,["current-page","page-size","total"])]),_:1}),t(le,{modelValue:r(d),"onUpdate:modelValue":e[8]||(e[8]=o=>w(d)?d.value=o:d=o)},{header:n(()=>[y("h4",null,ie(r(s).objectId?"更新角色":"添加角色"),1)]),default:n(()=>[t(ae,{model:r(s),rules:T,ref_key:"roleFormRef",ref:i},{default:n(()=>[t(V,{label:"角色名称",prop:"name"},{default:n(()=>[t(h,{placeholder:"角色名称",modelValue:r(s).name,"onUpdate:modelValue":e[4]||(e[4]=o=>r(s).name=o),disabled:!!r(s).objectId,clearable:""},null,8,["modelValue","disabled"])]),_:1}),t(V,{label:"角色描述",prop:"description"},{default:n(()=>[t(h,{placeholder:"角色描述",modelValue:r(s).description,"onUpdate:modelValue":e[5]||(e[5]=o=>r(s).description=o),clearable:""},null,8,["modelValue"])]),_:1}),t(V,{label:"角色权限",prop:"description"},{default:n(()=>[t(ee,{ref_key:"treeRef",ref:C,data:r(s).permissionArr,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":r(z),props:$},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])]),footer:n(()=>[y("div",ze,[t(l,{type:"primary",onClick:e[6]||(e[6]=o=>Q(r(i)))},{default:n(()=>[b("保存")]),_:1}),t(l,{onClick:e[7]||(e[7]=o=>w(d)?d.value=!1:d=!1)},{default:n(()=>[b("取消")]),_:1})])]),_:1},8,["modelValue"])])}}}),Ue=je(He,[["__scopeId","data-v-280d4df2"]]);export{Ue as default};
