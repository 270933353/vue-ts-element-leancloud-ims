import{a as se,A as m,n as H,ai as ne,ap as f,M as p,a4 as S,aj as de,o as v,c as z,e as t,w as s,b as U,y as A,g as y,K as w,u as n,B as V,t as ue,f as ie,F as ce,h as pe,an as me,U as q,ae as ve,i as _e,aa as be,at as ge,au as fe,av as ye,aw as we,ak as he,D as Ue,ax as Ve,G as ke,H as Ce,ay as Ye,az as Ae,_ as je}from"./index-vpA-h1lW.js";/* empty css                  *//* empty css                   */import{r as xe,a as De,b as Ie,c as Me,d as Ee}from"./index-eBvZNokl.js";import{a as He,b as Se,e as ze}from"./validator-RQhN6wQS.js";const qe={class:"header"},Be={class:"left"},Ne={class:"right"},Pe={style:{flex:"auto"}},Oe=se({__name:"index",setup(Ke){let _=m([]),D=m([]),i=m(1),b=m(10),B=H(()=>_.value.length);const N=H(()=>{const a=(i.value-1)*b.value,e=a+b.value;return console.log("data1",_),_.value.slice(a,e)});ne(()=>{j()});const I=a=>{const e=me();return!(e&&a===e.id)},j=async()=>{await xe().then(a=>{_.value=a.map(e=>({...e.attributes,objectId:e.id,createdAt:f(e.createdAt).format("YYYY-MM-DD HH:mm:ss"),updatedAt:f(e.updatedAt).format("YYYY-MM-DD HH:mm:ss")}))},a=>{p({type:"error",message:"获取全部用户信息失败 "+a})})},M=async()=>{await Ye().then(a=>{D.value=a.map(e=>({...e.attributes,objectId:e.id,createdAt:f(e.createdAt).format("YYYY-MM-DD HH:mm:ss"),updatedAt:f(e.updatedAt).format("YYYY-MM-DD HH:mm:ss")}),e=>{p({type:"error",message:"获取全部角色信息失败 "+e})})})},P=a=>{i.value=a},O=a=>{b.value=a};let o=m(),u=m(!1),d=S({objectId:"",username:"",password:"",nickname:"",role:""});const K=S({username:[{required:!1,trigger:"blur",validator:He}],password:[{required:!1,trigger:"blur",validator:Se}],nickname:[{required:!1,trigger:"blur",validator:ze}]}),T=()=>{M(),u.value=!0,Object.assign(d,{objectId:"",username:"",password:"",nickname:"",role:""}),q(()=>{var a,e,r,g;(a=o==null?void 0:o.value)==null||a.clearValidate("username"),(e=o==null?void 0:o.value)==null||e.clearValidate("password"),(r=o==null?void 0:o.value)==null||r.clearValidate("nickname"),(g=o==null?void 0:o.value)==null||g.clearValidate("role")})},Q=a=>{M(),u.value=!0,Object.assign(d,a),q(()=>{var e,r,g;(e=o==null?void 0:o.value)==null||e.clearValidate("username"),(r=o==null?void 0:o.value)==null||r.clearValidate("nickname"),(g=o==null?void 0:o.value)==null||g.clearValidate("role")})},G=async a=>{await De(a).then(()=>{u.value=!1,p({type:"success",message:"删除成功"}),j(),i.value=_.value.length>1?i.value:i.value-1},e=>{u.value=!1,p({type:"error",message:"删除失败 "+e})})};let x=m([]);const L=a=>{x.value=a},$=async()=>{let a=x.value.map(e=>e.objectId);await Ie(a).then(e=>{console.log(e),p({type:"success",message:"批量删除成功"}),j(),i.value=_.value.length>1?i.value:i.value-1},e=>{p({type:"error",message:"批量删除失败 "+e})})},J=async a=>{a&&await a.validate(async e=>{e?Me(d).then(()=>{u.value=!1,p({type:"success",message:d.objectId?"更新成功":"添加成功"}),window.location.reload()},r=>{u.value=!1,p({type:"error",message:d!=null&&d.objectId?"更新失败 "+r:"添加失败 "+r})}):p({type:"error",message:"表单校验失败"})})};let h=m("");const E=async a=>{await Ee("username",a).then(e=>{_.value=e.map(r=>({...r.attributes,objectId:r.id,createdAt:f(r.createdAt).format("YYYY-MM-DD HH:mm:ss"),updatedAt:f(r.updatedAt).format("YYYY-MM-DD HH:mm:ss")}))})},W=async a=>{E(a)},X=()=>{E("")};return(a,e)=>{const r=ve,g=_e,k=be,c=ge,Z=fe,R=ye,F=we,ee=he,C=Ue,ae=Ae,le=Ve,te=ke,oe=Ce,Y=de("has");return v(),z("div",null,[t(ee,null,{default:s(()=>[U("div",qe,[U("div",Be,[A((v(),y(r,{type:"primary",onClick:T},{default:s(()=>[w(" 添加账号 ")]),_:1})),[[Y,"btn.user.add"]]),A((v(),y(r,{type:"primary",onClick:$,disabled:!n(x).length},{default:s(()=>[w(" 批量删除 ")]),_:1},8,["disabled"])),[[Y,"btn.user.removeSelect"]])]),U("div",Ne,[t(k,{modelValue:n(h),"onUpdate:modelValue":e[1]||(e[1]=l=>V(h)?h.value=l:h=l),placeholder:"请输入账号搜索",clearable:"",onClear:X},{suffix:s(()=>[t(g,{name:"iconfont-search",style:{cursor:"pointer",fontSize:"20px"},onClick:e[0]||(e[0]=l=>W(n(h)))})]),_:1},8,["modelValue"])])]),t(R,{style:{margin:"10px 0px"},border:"",data:N.value,onSelectionChange:L},{default:s(()=>[t(c,{type:"selection",align:"center",fixed:"left"}),t(c,{label:"#",align:"center",type:"index"}),t(c,{label:"ID",align:"center",prop:"objectId","show-overflow-tooltip":""}),t(c,{label:"账号",align:"center",prop:"username","show-overflow-tooltip":""}),t(c,{label:"昵称",align:"center",prop:"nickname","show-overflow-tooltip":""}),t(c,{label:"角色",align:"center",prop:"role","show-overflow-tooltip":""}),t(c,{label:"邮箱",align:"center",prop:"email","show-overflow-tooltip":""}),t(c,{label:"手机号",align:"center",prop:"mobilePhoneNumber","show-overflow-tooltip":""}),t(c,{label:"创建时间",align:"center",prop:"createdAt","show-overflow-tooltip":""}),t(c,{label:"更新时间",align:"center",prop:"updatedAt","show-overflow-tooltip":""}),t(c,{label:"操作",width:"160px",align:"center",fixed:"right"},{default:s(({row:l})=>[A((v(),y(r,{type:"primary",size:"small",onClick:re=>Q(l),disabled:I(l.objectId)},{default:s(()=>[w(" 编辑 ")]),_:2},1032,["onClick","disabled"])),[[Y,"btn.user.edit"]]),t(Z,{title:`确认删除 ${l.username}?`,width:"200px",onConfirm:re=>G(l.objectId)},{reference:s(()=>[A((v(),y(r,{type:"primary",size:"small",disabled:I(l.objectId)},{default:s(()=>[w(" 删除 ")]),_:2},1032,["disabled"])),[[Y,"btn.user.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),t(F,{"current-page":n(i),"onUpdate:currentPage":e[2]||(e[2]=l=>V(i)?i.value=l:i=l),"page-size":n(b),"onUpdate:pageSize":e[3]||(e[3]=l=>V(b)?b.value=l:b=l),"page-sizes":[10,20,50],layout:"prev, pager, next, jumper,->,sizes,total",total:n(B),background:"",onCurrentChange:P,onSizeChange:O},null,8,["current-page","page-size","total"])]),_:1}),t(oe,{modelValue:n(u),"onUpdate:modelValue":e[10]||(e[10]=l=>V(u)?u.value=l:u=l)},{header:s(()=>[U("h4",null,ue(n(d).objectId?"更新账号":"添加账号"),1)]),default:s(()=>[t(te,{model:n(d),rules:K,ref_key:"userFormRef",ref:o},{default:s(()=>[t(C,{label:"账号",prop:"username"},{default:s(()=>[t(k,{placeholder:"账号",modelValue:n(d).username,"onUpdate:modelValue":e[4]||(e[4]=l=>n(d).username=l),clearable:""},null,8,["modelValue"])]),_:1}),n(d).objectId?ie("",!0):(v(),y(C,{key:0,label:"密码",prop:"password"},{default:s(()=>[t(k,{placeholder:"密码",modelValue:n(d).password,"onUpdate:modelValue":e[5]||(e[5]=l=>n(d).password=l)},null,8,["modelValue"])]),_:1})),t(C,{label:"昵称",prop:"nickname"},{default:s(()=>[t(k,{placeholder:"昵称",modelValue:n(d).nickname,"onUpdate:modelValue":e[6]||(e[6]=l=>n(d).nickname=l),clearable:""},null,8,["modelValue"])]),_:1}),t(C,{label:"角色",prop:"role"},{default:s(()=>[t(le,{modelValue:n(d).role,"onUpdate:modelValue":e[7]||(e[7]=l=>n(d).role=l),placeholder:"角色"},{default:s(()=>[(v(!0),z(ce,null,pe(n(D),l=>(v(),y(ae,{key:l.name,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),footer:s(()=>[U("div",Pe,[t(r,{type:"primary",onClick:e[8]||(e[8]=l=>J(n(o)))},{default:s(()=>[w(" 确定 ")]),_:1}),t(r,{onClick:e[9]||(e[9]=l=>V(u)?u.value=!1:u=!1)},{default:s(()=>[w("取消")]),_:1})])]),_:1},8,["modelValue"])])}}}),Je=je(Oe,[["__scopeId","data-v-3a57af4f"]]);export{Je as default};
