import{aA as Q,a4 as ve,a as _e,A as V,m as fe,ai as he,o as t,c as v,e as y,w as a,b as A,u as s,K as g,t as _,B as K,F as B,h as I,y as be,g as b,aI as O,M as Y,ap as ke,L as X,ae as ye,i as ge,aa as Ve,aJ as we,aK as xe,aL as De,ax as Te,aM as Ue,aN as Ce,ak as je,aO as Re,U as Z,aP as Se,ab as Me,az as Ye,_ as qe}from"./index-vpA-h1lW.js";/* empty css                   */const Ae=()=>new Promise((C,w)=>{const i=new Q.Query("Data");i.equalTo("name","risk"),i.find().then(m=>{C(m[0].attributes.value)},m=>{w(m)})}),Ee=C=>new Promise((w,i)=>{const m=new Q.Query("Data");m.equalTo("name","risk"),m.find().then(U=>{console.log("res",U);const q=Q.Object.createWithoutData("Data",U[0].id);q.set("value",C),q.save().then(d=>{w(d)},d=>{i(d)})},U=>{i(U)})}),Be=()=>new Promise((C,w)=>{const i=new Q.Query("Data");i.equalTo("name","riskSystem"),i.find().then(m=>{C(m[0].attributes.value)},m=>{w(m)})}),Ie=()=>new Promise((C,w)=>{const i=new Q.Query("Data");i.equalTo("name","riskRegion"),i.find().then(m=>{C(m[0].attributes.value)},m=>{w(m)})}),Qe=ve([{prop:"id",label:"ID",width:41,showTip:!0},{prop:"addtime",label:"记录时间",width:145,sortable:!0,showTip:!0},{prop:"add",label:"记录人",width:68,showTip:!0},{prop:"job",label:"岗位",width:53,showTip:!0},{prop:"region",label:"作业区",width:100,showTip:!0},{prop:"system",label:"系统",width:86,showTip:!0},{prop:"equipment",label:"设备",width:200,showTip:!0},{prop:"risk",label:"异常",minWidth:300,showTip:!0},{prop:"repair",label:"点检",width:90,showTip:!0},{prop:"plantime",label:"计划整改时间",width:128,showTip:!0},{prop:"content",label:"整改内容",minWidth:150,showTip:!0},{prop:"done",label:"整改情况",width:112,showTip:!0},{prop:"actualtime",label:"实际整改时间",width:128,showTip:!0},{prop:"confirm",label:"确认人",width:68,showTip:!0},{prop:"remark",label:"备注",width:100,showTip:!0},{label:"操作",prop:"operation",width:158,align:"center",fixed:"right"}]),Le={class:"header1"},Ne={class:"left"},Oe={class:"right"},Pe={class:"header2"},Je={key:1},He={key:1},Ke={key:1},We={key:1},ze={key:1},Fe={key:1},$e={key:1},Ge={key:1},Xe={key:1},Ze={key:1},el={key:0},ll={key:1},al=_e({__name:"index",setup(C){let w=V(["已完成","未完成"]),i=V([]);const m=()=>{r.value="",z(),c.value=c.value.filter(l=>i.value.includes(l.system)&&w.value.includes(l.done?"已完成":"未完成"))},U=V();let q=V(!1);const d=fe();let P=V([]);const ee=async()=>{await Ie().then(l=>{P.value=l},l=>{Y({type:"error",message:"导入作业区分类信息失败 "+l})})};let x=V([]);const le=async()=>{await Be().then(l=>{var o,h,M,D,j,R,S,f;(o=d.job)!=null&&o.includes("管理员")||(h=d.job)!=null&&h.includes("领导")||(M=d.job)!=null&&M.includes("调度工长")?i.value=x.value=l:(D=d.job)!=null&&D.includes("动力调度")?i.value=x.value=["动"]:(j=d.job)!=null&&j.includes("水电调度")?i.value=x.value=["电","水"]:(R=d.job)!=null&&R.includes("主厂区动力巡检")?i.value=x.value=["动"]:(S=d.job)!=null&&S.includes("主厂区水电巡检")?i.value=x.value=["电","水"]:(f=d.job)!=null&&f.includes("五丰塘能源巡检")?i.value=x.value=l:i.value=x.value=[]},l=>{Y({type:"error",message:"导入系统分类信息失败 "+l})})};let W=[{text:"已完成",value:!0},{text:"未完成",value:!1}],k=V([]);const ae=async()=>{await Ae().then(l=>{k.value=l,z()},l=>{Y({type:"error",message:"导入隐患数据失败 "+l})})};let c=V([]);const z=()=>{var l,o,h,M,D,j,R,S;(l=d.job)!=null&&l.includes("管理员")||(o=d.job)!=null&&o.includes("领导")?c.value=k.value:(h=d.job)!=null&&h.includes("调度工长")?c.value=k.value.filter(f=>{var p;return(p=f.job)==null?void 0:p.includes("调度")}):(M=d.job)!=null&&M.includes("动力调度")?c.value=k.value.filter(f=>{var p;return(p=f.job)==null?void 0:p.includes("动力调度")}):(D=d.job)!=null&&D.includes("水电调度")?c.value=k.value.filter(f=>{var p;return(p=f.job)==null?void 0:p.includes("水电调度")}):(j=d.job)!=null&&j.includes("主厂区动力巡检")?c.value=k.value.filter(f=>{var p;return(p=f.job)==null?void 0:p.includes("主厂区动力巡检")}):(R=d.job)!=null&&R.includes("主厂区水电巡检")?c.value=k.value.filter(f=>{var p;return(p=f.job)==null?void 0:p.includes("主厂区水电巡检")}):(S=d.job)!=null&&S.includes("五丰塘能源巡检")?c.value=k.value.filter(f=>{var p;return(p=f.job)==null?void 0:p.includes("五丰塘能源巡检")}):c.value=[]};he(()=>{q.value=!0,d.getUserInfo(),ee(),le(),ae(),q.value=!1});const L=async l=>{await Ee(k.value).then(()=>{Y({type:"success",message:l+"成功 "})},o=>{Y({type:"error",message:l+"失败 "+o})})},T=V("空"),te=()=>{U.value.ref.setCurrentRow(U.value.ref.data[0]),r.value="",U.value.ref.clearSort(),c.value=c.value.filter(o=>o.id!==T.value);const l={id:T.value,addtime:ke().format("YYYY-MM-DD HH:MM"),add:d.nickname,job:d.job,region:P.value[0],system:x.value[0],equipment:"",risk:"",repair:"",plantime:"",content:"",actualtime:"",done:!1,confirm:"",remark:""};c.value.unshift(l),r.value=T.value},oe=l=>{X({title:"提示",message:"确认删除该数据?",dangerouslyUseHTMLString:!0,showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(()=>{k.value=k.value.filter(o=>o.id!==l.id),L("删除"),m()}).catch(o=>{o!=="cancel"&&Y({type:"error",message:"删除失败 "+o})})};let E=V([]);const ne=l=>{E.value=l},se=()=>{X({title:"提示",message:"确认删除选中的数据?",dangerouslyUseHTMLString:!0,showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(()=>{k.value=k.value.filter(l=>!E.value.some(o=>l.id===o.id)),L("批量删除"),m()}).catch(l=>{Y({type:"error",message:"批量删除失败 "+l})})};let r=V(""),F=V();const J=V(),ue=l=>{F.value=JSON.parse(JSON.stringify(l)),r.value=l.id,Z(()=>{J.value&&J.value.focus()})},ie=l=>{c.value.find(h=>h.id===T.value)?c.value=c.value.filter(h=>h.id!==T.value):Object.assign(l,{...F.value}),r.value=""},de=()=>{let l=c.value.find(o=>o.id===T.value);l&&(l.id=Se.v4(),c.value=c.value.filter(o=>o.id!==T.value),k.value.unshift(l)),L("保存"),r.value="",Z(()=>{})};let N=V("");const $=l=>{r.value!==T.value&&r.value!==l.id&&(r.value="")};return(l,o)=>{const h=ye,M=ge,D=Ve,j=we,R=Me,S=xe,f=De,p=Ye,H=Te,G=Ue,re=Ce,ce=je,pe=Re;return t(),v("div",null,[y(ce,null,{default:a(()=>[A("div",Le,[A("div",Ne,[y(h,{type:"primary",onClick:te,disabled:s(r)===T.value},{default:a(()=>[g(" 添加隐患 ")]),_:1},8,["disabled"]),y(h,{type:"primary",disabled:!s(E).length,onClick:se},{default:a(()=>[g(_("批量删除 "+(s(E).length>0?s(E).length+" 行":"")),1)]),_:1},8,["disabled"])]),A("div",Oe,[y(D,{modelValue:s(N),"onUpdate:modelValue":o[0]||(o[0]=e=>K(N)?N.value=e:N=e),placeholder:"请输入异常"},{suffix:a(()=>[y(M,{name:"iconfont-search",style:{cursor:"pointer",fontSize:"20px"}})]),_:1},8,["modelValue"])])]),A("div",Pe,[A("div",null,[y(f,{wrap:""},{default:a(()=>[y(j,{class:"mx-1"},{default:a(()=>[g("系统分类：")]),_:1}),y(S,{modelValue:s(i),"onUpdate:modelValue":o[1]||(o[1]=e=>K(i)?i.value=e:i=e),onChange:m},{default:a(()=>[(t(!0),v(B,null,I(s(x),(e,u)=>(t(),b(R,{key:u,label:e},{default:a(()=>[g(_(e),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),A("div",null,[y(f,{wrap:""},{default:a(()=>[y(j,{class:"mx-1"},{default:a(()=>[g("完成情况：")]),_:1}),y(S,{modelValue:s(w),"onUpdate:modelValue":o[2]||(o[2]=e=>K(w)?w.value=e:w=e),onChange:m},{default:a(()=>[(t(!0),v(B,null,I(s(W),(e,u)=>(t(),b(R,{key:u,label:e.text},{default:a(()=>[g(_(e.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),be((t(),b(re,{ref_key:"tableRef",ref:U,showSelection:!0,showIndex:!0,tableColumns:s(Qe),tableData:s(c),onRowClick:$,onRowContextmenu:$,onSelectionChange:ne,border:"","highlight-current-row":"",style:{margin:"10px 0px"}},{id:a(({cell:e})=>[g(_(e),1)]),addtime:a(({cell:e})=>[g(_(e),1)]),add:a(({cell:e})=>[g(_(e),1)]),job:a(({cell:e})=>[g(_(e),1)]),region:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(H,{key:0,modelValue:e.region,"onUpdate:modelValue":n=>e.region=n},{default:a(()=>[(t(!0),v(B,null,I(s(P),n=>(t(),b(p,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),v("span",Je,_(u),1))]),system:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(H,{key:0,modelValue:e.system,"onUpdate:modelValue":n=>e.system=n},{default:a(()=>[(t(!0),v(B,null,I(s(x),n=>(t(),b(p,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),v("span",He,_(u),1))]),equipment:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(D,{key:0,modelValue:e.equipment,"onUpdate:modelValue":n=>e.equipment=n,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])):(t(),v("span",Ke,_(u),1))]),risk:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(D,{key:0,ref_key:"refInput",ref:J,modelValue:e.risk,"onUpdate:modelValue":n=>e.risk=n,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])):(t(),v("span",We,_(u),1))]),repair:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(D,{key:0,modelValue:e.repair,"onUpdate:modelValue":n=>e.repair=n,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])):(t(),v("span",ze,_(u),1))]),plantime:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(G,{key:0,modelValue:e.plantime,"onUpdate:modelValue":n=>e.plantime=n,type:"date",placeholder:"选择日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:!1},null,8,["modelValue","onUpdate:modelValue"])):(t(),v("span",Fe,_(u),1))]),content:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(D,{key:0,modelValue:e.content,"onUpdate:modelValue":n=>e.content=n,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])):(t(),v("span",$e,_(u),1))]),done:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(H,{key:0,modelValue:e.done,"onUpdate:modelValue":n=>e.done=n},{default:a(()=>[(t(!0),v(B,null,I(s(W),(n,me)=>(t(),b(p,{key:me,label:n.text,value:n.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),v("span",Ge,_(u?"已完成":"未完成"),1))]),actualtime:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(G,{key:0,modelValue:e.actualtime,"onUpdate:modelValue":n=>e.actualtime=n,type:"date",placeholder:"选择日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:!1},null,8,["modelValue","onUpdate:modelValue"])):(t(),v("span",Xe,_(u),1))]),confirm:a(({row:e})=>[g(_(e.done?s(d).nickname:""),1)]),remark:a(({row:e,cell:u})=>[e.id==s(r)?(t(),b(D,{key:0,modelValue:e.remark,"onUpdate:modelValue":n=>e.remark=n,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])):(t(),v("span",Ze,_(u),1))]),operation:a(({row:e})=>[e.id==s(r)?(t(),v("div",el,[y(h,{type:"primary",onClick:o[3]||(o[3]=O(u=>de(),["prevent"]))},{default:a(()=>[g(" 保存 ")]),_:1}),y(h,{onClick:O(u=>ie(e),["prevent"])},{default:a(()=>[g("取消")]),_:2},1032,["onClick"])])):(t(),v("div",ll,[y(h,{type:"success",onClick:O(u=>ue(e),["prevent"]),disabled:s(r)===T.value},{default:a(()=>[g(" 编辑 ")]),_:2},1032,["onClick","disabled"]),y(h,{type:"danger",onClick:O(u=>oe(e),["prevent"]),disabled:s(r)===T.value},{default:a(()=>[g(" 删除 ")]),_:2},1032,["onClick","disabled"])]))]),_:1},8,["tableColumns","tableData"])),[[pe,s(q)]])]),_:1})])}}}),nl=qe(al,[["__scopeId","data-v-33298bd8"]]);export{nl as default};
