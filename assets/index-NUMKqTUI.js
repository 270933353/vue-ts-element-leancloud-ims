import{a as R,A as v,ai as Y,an as b,ao as j,ap as N,a4 as _,m as D,o as T,g as z,w as s,e as a,u as t,K as w,a7 as f,a6 as A,U as B,aq as H,aa as $,D as O,ae as S,G as Z,ar as G,N as Q,as as K,ak as L,_ as J}from"./index-vpA-h1lW.js";/* empty css                  */import{r as c}from"./index-eBvZNokl.js";const W=R({__name:"index",setup(X){const y=v("info");Y(()=>{U()});const U=()=>{const n=b();l.avatar=n.attributes.avatar,l.username=n.attributes.username,l.nickname=n.attributes.nickname,l.mobilePhoneNumber=n.attributes.mobilePhoneNumber,l.email=n.attributes.email,l.job=n.attributes.job,j(n.attributes.role).then(e=>{l.role=e}),l.createdAt=N(n.createdAt).format("YYYY-MM-DD HH:mm:ss"),l.updatedAt=N(n.updatedAt).format("YYYY-MM-DD HH:mm:ss")};let g=v(),l=_({username:"",nickname:"",avatar:"",mobilePhoneNumber:"",email:"",job:"",role:"",createdAt:"",updatedAt:""}),E=_({username:[{required:!0,message:"请输入账号名称",trigger:"blur"},{validator:(n,e,r)=>{c().then(o=>{const u=b();o.find(i=>i.attributes.username===e&&i.attributes.username!==u.attributes.username)?r(new Error("账号名称已存在")):e.trim().length<5?r(new Error("账号名称长度至少五位")):r()})},trigger:"blur"}],nickname:[{required:!0,message:"请输入账号昵称",trigger:"blur"},{validator:(n,e,r)=>{c().then(o=>{const u=b();e===""?r():o.find(i=>i.attributes.nickname===e&&i.attributes.nickname!==u.attributes.nickname)?r(new Error("账号昵称已存在")):e.trim().length<2?r(new Error("账号昵称长度至少两位")):r()})},trigger:"blur"}],mobilePhoneNumber:[{validator:(n,e,r)=>{c().then(o=>{const u=b(),i=/^1[3456789]\d{9}$/;e===""||e===void 0?r():o.find(p=>p.attributes.mobilePhoneNumber===e&&p.attributes.mobilePhoneNumber!==u.attributes.mobilePhoneNumber)?r(new Error("手机号码已存在")):i.test(e)?r():(console.log("456"),r(new Error("请输入有效的手机号码")))})},trigger:"blur"}],email:[{validator:(n,e,r)=>{c().then(o=>{const u=b(),i=/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;e===""||e===void 0?r():o.find(p=>p.attributes.email===e&&p.attributes.email!==u.attributes.email)?r(new Error("邮箱已存在")):i.test(e)?r():r(new Error("请输入有效的邮箱"))})},trigger:"blur"}]});const h=async n=>{n&&await n.validate(e=>{if(e){const r=b();r?(r.setUsername(l.username),r.setEmail(l.email),r.setMobilePhoneNumber(l.mobilePhoneNumber),r.set("nickname",l.nickname),r.save().then(()=>{f({title:"保存成功",type:"success"})},o=>{f({title:"保存失败",type:"error",message:o.code+" "+o})})):f({title:"保存失败",type:"error",message:"current is null"})}else f({title:"表单校验失败",type:"error"})})},k=()=>{var n;(n=g.value)==null||n.clearValidate(),U()},P=D();let V=v(),m=_({oldPassword:"",newPassword:"",confirmPassword:""}),x=_({oldPassword:[{required:!0,message:"Please input the old password",trigger:"blur"},{validator:(n,e,r)=>{e!==A(P.lk)?r(new Error("旧密码错误")):r()},trigger:"blur"}],newPassword:[{required:!0,message:"Please input the new password",trigger:"blur"},{validator:(n,e,r)=>{e.trim().length<5?r(new Error("密码长度至少五位")):e===A(P.lk)?r(new Error("新密码不能与旧密码相同")):r()},trigger:"blur"}],confirmPassword:[{required:!0,message:"Please input the new password again",trigger:"blur"},{validator:(n,e,r)=>{e!==m.newPassword?r(new Error("Two inputs don't match!")):r()},trigger:"blur"}]});const q=async n=>{n&&await n.validate(e=>{if(e){const r=b();r?(r.setPassword(m.newPassword),r.save().then(()=>{f({title:"修改成功",type:"success",message:"请重新登录"}),B(()=>{P.userLogout(),H.push("/account/login")})},o=>{f({title:"保存失败",type:"error",message:o.code+" "+o})})):f({title:"保存失败",type:"error",message:"current is null"})}else f({title:"表单校验失败",type:"error"})})},C=()=>{var n;(n=V.value)==null||n.clearValidate(),Object.assign(m,{oldPassword:"",newPassword:"",confirmPassword:""})};return(n,e)=>{const r=$,o=O,u=S,i=Z,p=G,I=Q,F=K,M=L;return T(),z(M,null,{default:s(()=>[a(F,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=d=>y.value=d)},{default:s(()=>[a(p,{label:"个人资料",name:"info"},{default:s(()=>[a(i,{ref_key:"userInfoFormRef",ref:g,"label-width":"80px",model:t(l),rules:t(E)},{default:s(()=>[a(o,{label:"账号名称",prop:"username"},{default:s(()=>[a(r,{modelValue:t(l).username,"onUpdate:modelValue":e[0]||(e[0]=d=>t(l).username=d),placeholder:"请输入账号名称",clearable:""},null,8,["modelValue"])]),_:1}),a(o,{label:"账号昵称",prop:"nickname"},{default:s(()=>[a(r,{modelValue:t(l).nickname,"onUpdate:modelValue":e[1]||(e[1]=d=>t(l).nickname=d),placeholder:"请输入账号昵称",clearable:""},null,8,["modelValue"])]),_:1}),a(o,{label:"手机号码",prop:"mobilePhoneNumber"},{default:s(()=>[a(r,{modelValue:t(l).mobilePhoneNumber,"onUpdate:modelValue":e[2]||(e[2]=d=>t(l).mobilePhoneNumber=d),placeholder:"请输入手机号码",clearable:""},null,8,["modelValue"])]),_:1}),a(o,{label:"电子邮箱",prop:"email"},{default:s(()=>[a(r,{modelValue:t(l).email,"onUpdate:modelValue":e[3]||(e[3]=d=>t(l).email=d),placeholder:"请输入电子邮箱",clearable:""},null,8,["modelValue"])]),_:1}),a(o,{label:"所属岗位",prop:"job"},{default:s(()=>[a(r,{modelValue:t(l).job,"onUpdate:modelValue":e[4]||(e[4]=d=>t(l).job=d),clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),a(o,{label:"所属角色",prop:"role"},{default:s(()=>[a(r,{modelValue:t(l).role,"onUpdate:modelValue":e[5]||(e[5]=d=>t(l).role=d),clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),a(o,{label:"创建日期",prop:"createdAt"},{default:s(()=>[a(r,{modelValue:t(l).createdAt,"onUpdate:modelValue":e[6]||(e[6]=d=>t(l).createdAt=d),clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),a(o,{label:"修改日期",prop:"createdAt"},{default:s(()=>[a(r,{modelValue:t(l).updatedAt,"onUpdate:modelValue":e[7]||(e[7]=d=>t(l).updatedAt=d),clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),a(o,null,{default:s(()=>[a(u,{type:"primary",plain:"",onClick:e[8]||(e[8]=d=>h(t(g)))},{default:s(()=>[w(" 保存 ")]),_:1}),a(u,{type:"danger",plain:"",onClick:k},{default:s(()=>[w(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(p,{label:"修改密码",name:"password"},{default:s(()=>[a(i,{ref_key:"passwordFormRef",ref:V,"label-width":"80px",model:t(m),rules:t(x)},{default:s(()=>[a(o,{label:"旧密码",prop:"oldPassword"},{default:s(()=>[a(r,{modelValue:t(m).oldPassword,"onUpdate:modelValue":e[9]||(e[9]=d=>t(m).oldPassword=d),placeholder:"请输入旧密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),a(o,{label:"新密码",prop:"newPassword"},{default:s(()=>[a(r,{modelValue:t(m).newPassword,"onUpdate:modelValue":e[10]||(e[10]=d=>t(m).newPassword=d),placeholder:"请输入新密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),a(o,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[a(r,{modelValue:t(m).confirmPassword,"onUpdate:modelValue":e[11]||(e[11]=d=>t(m).confirmPassword=d),placeholder:"请输入确认密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),a(o,null,{default:s(()=>[a(u,{type:"primary",plain:"",onClick:e[12]||(e[12]=d=>q(t(V)))},{default:s(()=>[w(" 保存 ")]),_:1}),a(u,{type:"danger",plain:"",onClick:C},{default:s(()=>[w(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(p,{label:"更换头像",name:"avatar"},{default:s(()=>[a(i,{ref:"userAvatarFormRef","label-width":"80px",model:t(l),rules:t(E)},{default:s(()=>[a(o,{label:"用户头像"},{default:s(()=>[a(I,{shape:"square",size:150,src:t(l).avatar},null,8,["src"])]),_:1}),a(o,null,{default:s(()=>[w("头像")]),_:1}),a(o,null,{default:s(()=>[a(u,{type:"primary",plain:""},{default:s(()=>[w("保存")]),_:1}),a(u,{type:"danger",plain:""},{default:s(()=>[w("重置")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),ie=J(W,[["__scopeId","data-v-45cad76e"]]);export{ie as default};
